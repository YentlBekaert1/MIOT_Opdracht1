(()=>{var e={320:(e,s,t)=>{const n=t(860).Router();n.get("/",((e,s,t)=>{s.status(200).json({message:"Handling GET requests to /activities"})})),n.post("/",((e,s,t)=>{s.status(201).json({message:"Handling POST requests to /activities"})})),n.get("/:activitiesId",((e,s,t)=>{const n=e.params.productId;"special"===n?s.status(200).json({message:"You discovered the special ID",id:n}):s.status(200).json({message:"You passed an ID"})})),n.patch("/:activitiesId",((e,s,t)=>{s.status(200).json({message:"Updated product!"})})),n.delete("/:activitiesId",((e,s,t)=>{s.status(200).json({message:"Deleted product!"})})),e.exports=n},860:e=>{"use strict";e.exports=require("express")},185:e=>{"use strict";e.exports=require("mongoose")}},s={};function t(n){var o=s[n];if(void 0!==o)return o.exports;var a=s[n]={exports:{}};return e[n](a,a.exports,t),a.exports}t.n=e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return t.d(s,{a:s}),s},t.d=(e,s)=>{for(var n in s)t.o(s,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:s[n]})},t.o=(e,s)=>Object.prototype.hasOwnProperty.call(e,s),(()=>{"use strict";var e=t(860),s=t.n(e);const n=require("web-push");var o=t.n(n);const a=process.env.VAPID_PUBLIC_KEY||"BGAQXJhUhnN82amHyv0Q3JjGGQfsghtqS3bShmHtG3me2MtGTdQUjTIk3HFDpoG33tLaemXxy6jV9d_1lpXGWwE",i=process.env.VAPID_PRIVATE_KEY||"2gQ9fKp1dR3wN1ILUOntY4NilojRch10VAEXiVdlTRk";""===a||""===i?(console.log("You must set the VAPID_PUBLIC_KEY and VAPID_PRIVATE_KEY environment variables. You can use the following ones:"),console.log(o().generateVAPIDKeys())):o().setVapidDetails("mailto:email@outlook.com",a,i);var c=o(),r=a,d=t(185),u=t.n(d);const l=process.env.DATABASE_CONNECTION_URI||"mongodb+srv://app:mytrainingsdata@cluster0.s2fwk.mongodb.net/myFirstDatabase?retryWrites=true&w=majority";""===l&&console.error("Database connection URI not defined."),u().Promise=global.Promise;const{Schema:p}=u(),g=new p({endpoint:{type:String,index:!0},keys:{auth:{type:String},p256dh:{type:String}},created:{type:Date,default:Date.now}}),y=u().model("Subscription",g);!async function(){try{await u().connect(l)}catch(e){console.error("Connection the database failed.")}}();var m=y;const f=require("cors");var h=t.n(f);t(320);const b=s()(),v=__dirname;b.disable("x-powered-by"),b.use(s().static(v)),b.use(h()()),b.use(s().json()),b.use(s().urlencoded({extended:!0})),b.get("/push/key",(async function(e,s){""!==r?s.send({key:r}):s.status(500).send({key:"VAPID KEYS ARE NOT SET"})})),b.post("/push/subscribe",(async function(e,s){try{const t=e.body.subscription;if(await m.findOne({endpoint:t.endpoint}))return void s.status(400).send("Subscription already exists");await new m(t).save(),s.status(200).send("Success")}catch(e){s.status(500).send(e.message)}})),b.post("/push/unsubscribe",(async function(e,s){try{const t=e.body.subscription;await m.remove({endpoint:t.endpoint}),console.log("Deleted: "+t.endpoint),s.status(200).send("Success")}catch(e){s.status(500).send(e.message)}})),b.post("/push/notify",(async function(e,s){const t=e.body,n=async function(){try{await c.sendNotification(t.subscription,t.payload,{contentEncoding:"aes128gcm"}).then((function(e){console.log("Response: "+JSON.stringify(e,null,4)),s.status(201).send(e)})).catch((function(e){console.log("Error: "+JSON.stringify(e,null,4)),s.status(201).send(e)}))}catch(e){s.status(500).send(e.message)}};t.delay?setTimeout(n,t.delay):n()})),b.post("/push/notify-demo",(async function(e,s){try{const e=t(185).Types.ObjectId,n=await m.findOne({_id:new e("616e91ac9693ad205b466de5")});await c.sendNotification(n,JSON.stringify({title:"Annoyed yet?",message:"Hello there!"}),{contentEncoding:"aes128gcm"}).then((function(e){console.log("Response: "+JSON.stringify(e,null,4)),s.status(201).send(e)})).catch((function(e){console.log("Error: "+JSON.stringify(e,null,4)),s.status(201).send(e)}))}catch(e){s.status(500).send(e.message)}}));const I=process.env.PORT||3e3;b.listen(I,(()=>{console.log(`App listening to ${I}....`),console.log("Press Ctrl+C to quit.")}))})()})();