(()=>{var e={320:(e,t,s)=>{const n=s(860).Router();n.get("/",((e,t,s)=>{t.status(200).json({message:"Handling GET requests to /activities"})})),n.post("/",((e,t,s)=>{t.status(201).json({message:"Handling POST requests to /activities"})})),n.get("/:activitiesId",((e,t,s)=>{const n=e.params.productId;"special"===n?t.status(200).json({message:"You discovered the special ID",id:n}):t.status(200).json({message:"You passed an ID"})})),n.patch("/:activitiesId",((e,t,s)=>{t.status(200).json({message:"Updated product!"})})),n.delete("/:activitiesId",((e,t,s)=>{t.status(200).json({message:"Deleted product!"})})),e.exports=n},860:e=>{"use strict";e.exports=require("express")},185:e=>{"use strict";e.exports=require("mongoose")}},t={};function s(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,s),a.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=require("path");var t=s.n(e),n=s(860),o=s.n(n);const a=require("web-push");var i=s.n(a);const c=process.env.VAPID_PUBLIC_KEY||"BGAQXJhUhnN82amHyv0Q3JjGGQfsghtqS3bShmHtG3me2MtGTdQUjTIk3HFDpoG33tLaemXxy6jV9d_1lpXGWwE",r=process.env.VAPID_PRIVATE_KEY||"2gQ9fKp1dR3wN1ILUOntY4NilojRch10VAEXiVdlTRk";""===c||""===r?(console.log("You must set the VAPID_PUBLIC_KEY and VAPID_PRIVATE_KEY environment variables. You can use the following ones:"),console.log(i().generateVAPIDKeys())):i().setVapidDetails("mailto:email@outlook.com",c,r);var d=i(),u=c,l=s(185),p=s.n(l);const g=process.env.DATABASE_CONNECTION_URI||"mongodb+srv://app:mytrainingsdata@cluster0.s2fwk.mongodb.net/myFirstDatabase?retryWrites=true&w=majority";""===g&&console.error("Database connection URI not defined."),p().Promise=global.Promise;const{Schema:y}=p(),m=new y({endpoint:{type:String,index:!0},keys:{auth:{type:String},p256dh:{type:String}},created:{type:Date,default:Date.now}}),f=p().model("Subscription",m);!async function(){try{await p().connect(g)}catch(e){console.error("Connection the database failed.")}}();var h=f;const b=s(320),v=o()(),I=__dirname,w=t().join(I,"index.html");v.disable("x-powered-by"),v.use(o().static(I)),v.use(o().json()),v.use(o().urlencoded({extended:!0})),v.get("/",((e,t)=>{t.sendFile(w)})),v.get("/get",((e,t)=>{t.json("test")})),v.use("/activities",b),v.get("/push/key",(async function(e,t){""!==u?t.send({key:u}):t.status(500).send({key:"VAPID KEYS ARE NOT SET"})})),v.post("/push/subscribe",(async function(e,t){try{const s=e.body.subscription;if(await h.findOne({endpoint:s.endpoint}))return void t.status(400).send("Subscription already exists");await new h(s).save(),t.status(200).send("Success")}catch(e){t.status(500).send(e.message)}})),v.post("/push/unsubscribe",(async function(e,t){try{const s=e.body.subscription;await h.remove({endpoint:s.endpoint}),console.log("Deleted: "+s.endpoint),t.status(200).send("Success")}catch(e){t.status(500).send(e.message)}})),v.post("/push/notify",(async function(e,t){const s=e.body,n=async function(){try{await d.sendNotification(s.subscription,s.payload,{contentEncoding:"aes128gcm"}).then((function(e){console.log("Response: "+JSON.stringify(e,null,4)),t.status(201).send(e)})).catch((function(e){console.log("Error: "+JSON.stringify(e,null,4)),t.status(201).send(e)}))}catch(e){t.status(500).send(e.message)}};s.delay?setTimeout(n,s.delay):n()})),v.post("/push/notify-demo",(async function(e,t){try{const e=s(185).Types.ObjectId,n=await h.findOne({_id:new e("616e91ac9693ad205b466de5")});await d.sendNotification(n,JSON.stringify({title:"Annoyed yet?",message:"Hello there!"}),{contentEncoding:"aes128gcm"}).then((function(e){console.log("Response: "+JSON.stringify(e,null,4)),t.status(201).send(e)})).catch((function(e){console.log("Error: "+JSON.stringify(e,null,4)),t.status(201).send(e)}))}catch(e){t.status(500).send(e.message)}}));const S=process.env.PORT||8080;v.listen(S,(()=>{console.log(`App listening to ${S}....`),console.log("Press Ctrl+C to quit.")}))})()})();